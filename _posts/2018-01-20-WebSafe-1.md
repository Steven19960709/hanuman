---
layout: post
title: Web安全相关基础知识
date: 2018-01-20
tags: [WebSafe]
---

## Web安全的兴起

Web1.0时代，人们更多的是关注服务器端动态脚本的安全问题，比如将一个可执行的脚本（Webshell）上传到服务器上，从而获得权限。SQL注入的出现是Web安全史上的一个里程碑，是Web安全的头号大敌。XSS（跨站脚本攻击）则是Web安全的另一个里程碑伴随着Web2.0的兴起，XSS,CSRF扥共攻击变得更加强大，Web攻击的思路也从服务器转向客户端。

安全三要素：机密性，完整性，可用性

### 白帽子兵法

#### secure by default

设计安全方案的时候，最重要的原则就是“secure by default”。具体为以下是两个方面：

- 黑名单 白名单做法。

例如：白名单思想，在处理用户提交的富文本是，考虑到XSS问题，需要做安全检查，一般使用HTML Parse ，解析成标签对象是，针对标签匹配XSS的规则，规则列表就是一个ie白名单，如果使用黑名单，例如禁用注入 script iframe标签，就可能在未来html更新的时候出现疏漏。

- 最小权限原则

要求系统只授予主体必要的权限，不过度授权，这样能有效地减少系统网络应用数据库出错的机会

#### 纵深防御原则 

同样重要的原则，Defense in Depth（纵深防御）也是设计安全方案时的重要思想，包含两层含义，首先，要在各个不同层面、不同方面实施安全方案，避免出现漏洞。契尔氏，要在正确的地方做正确的事情，有针对性地试试安全方案。

例如，生产一滴水的过程，要通过十几层的安全过滤，去除有害物质。这种多层过滤的体系就是纵深防御，是有立体层次的安全方案。

在常见的入侵案例中，大多数是利用Web应用的漏洞，攻击者先获得一个低权限的webshell，然后通过低权限的违背设立了上传更多的文件，并尝试执行更高权限的系统命令，企图获得最高权限。

还有就是在在正确的地方做正确的事情，例如，在XSS防御中，可能会存在误杀的情况。用户输入1 < 2,采用匹配过滤特殊字符的话，<好就被过滤掉，造成误杀。后续会在讨论这个问题。

#### 数据与代码分离原则

由注入引起的问题比比皆是，如XSS、SQL Injection，等，这些都可以用这个原则进行设计安全解决方案。简单来说，见如下代码：

    <html>
        <head>
            <body>
                $var
            </body>
        </head>
    </html>
    
简单理解，$var使用户指定的数据，如果这个数据是一个script标签，那么就会出现问题，Browser就会解析这个语句，这样就能达到注入的效果。，这样我们需要做出解决方案。

## 浏览器安全

这个就是今天的主要内容。

### 同源策略

同源策略（Same Origin Policy）是一种约定，它是浏览器最核心也是最基本的安全策略，如果缺少了同源策略，则浏览器的正常功能都会受到影响。注意的是，同源策略是浏览器的一个概念。

浏览器的同源策略，限制了来自不同源的document或脚本对当前document读取或设置某些属性。

按照我的理解：
  
    URL http://store.company.com/..........

这样一个URL，前三个/的内容必须一模一样，才能算是同源的，包括是哪个部分，host（域名或者是IP地址），子域名，端口，协议。

有一点要注意的是，考虑这样的情况，在a.com下面有以下代码：
  
    <script src="http://b.com/b.js></script>
    
这样加载了b.com上的b.js但是b.js运行在a.com上面，这样b.js的origin就是a.com而不是b.com。

还有一点要注意的是，在浏览器中，script，img，iframe，link标签，都可以跨域加载资源，而不受到同源的限制，这些带src属性的标签每次加载时，实际上是由浏览器发起了一次GET请求，不同于XMLHttpRequest的是，通过属性加在资源，浏览器限制了javascript的权限，不能读，写返回的内容。

浏览器的安全架构：Chrome为例，主要进程分为，浏览器进程，渲染进程，插件进程，扩展进程。插件进程包括，flash，java，PDF等与浏览器进程隔离。

渲染引擎有Sandbox隔离，网页代码要以浏览器内核进程通信，与操作系统通信都需要通过IPC channel，在其中会进行一些安全检查。

简单来说，Sandbox沙箱，是一个安全检查奇，资源隔离的一个模块。设计目的是为了让不可信任的代码运行在一定的环境中，限制不可信任的代码访问隔离区之外的资源。采用Sandbox技术，无疑让不受信任的网页代码，javascript代码，运行在一个受限制的环境汇总，从而保护本地桌面系统的安全。

那么这部分的内容就先介绍到这，希望大家能有所收获。





























