---
layout: post
title: websocket https握手过程等网络相关问题
date: 2017-10-09
tags: [Interview,html5,net]
---

这篇文章是关于websocket的。在这里Mark一下，方便以后查看。
[webSocket原理](https://www.zhihu.com/question/20215561)

## https 相关知识

之前的http是我们平常用的一种协议，但是这种协议传输的数据都是未加密的，都是明文的，因此使用http协议传输隐私信息非常不安全。为了保证这些隐私数据能够加密传输，于是网景公司设计了SSL（Secure Sockets Layer)协议，用于对http协议传输的数据进行加密，于是就诞生了https。后续SSL各种升级，目前使用的为TLS协议。（https十分安全）

### 工作原理

https在传输之前需要客户端（浏览器）与服务端(网站)之间进行一次握手，在握手过程中将确立双方加密传输的密码信息。TLS/SSL协议是一套加密传输的协议，使用了费堆成加密，对称加密以及hash算法。握手过程：

- 客户端发起https请求

- 服务端配置 ：采用https的服务器必须要有一套数字证书，可以是自己制作或者CA证书，取别在于自己颁发的证书需要客户端验证通过，才可以继续访问，而使用CA证书则不会弹出提示页面。这套证书其实就是一对公钥和私钥。公钥给别人加密使用，私钥给自己解密使用。

- 传送证书，包含很多信息，证书的颁发机构，过期时间等 

- 客户端解析证书 由客户端tls来完成，先验证公钥是否有效，等其他信息，异常则会抛出一个警告框，提示证书有问题。没问题就会生成一个随机值，然后对随机值加密。

- 传送加密信息 ：这部分传送的是用证书加密后的随机值，目的就是让服务端得到这个随机值，以后客户端和服务端的通信就可以通过这个随机值来进行加密解密了。

- 服务端解密信息：服务端用私钥解密后，得到了客户端传过来的随机值(私钥)，然后把内容通过该值进行对称加密。所谓对称加密就是，将信息和私钥通过某种算法混合在一起，这样除非知道私钥，不然无法获取内容，而正好客户端和服务端都知道这个私钥，所以只要加密算法够彪悍，私钥够复杂，数据就够安全。

- 传输加密后的信息：这部分信息是服务段用私钥加密后的信息，可以在客户端被还原。

- 客户端解密信息：客户端用之前生成的私钥解密服务段传过来的信息，于是获取了解密后的内容。

PS: 整个握手过程第三方即使监听到了数据，也束手无策。

### https和http的区别

1. https协议需要到ca申请证书或自制证书。

2. http的信息是明文传输，https则是具有安全性的ssl加密。

3. http是直接与TCP进行数据传输，而https是经过一层SSL（OSI表示层），用的端口也不一样，前者是80（需要国内备案），后者是443。

4. http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

HTTPS一般使用的加密与HASH算法如下：

非对称加密算法：RSA，DSA/DSS

对称加密算法：AES，RC4，3DES

HASH算法：MD5，SHA1，SHA256

## 常用的状态码

- 100 ：初始的请求已经接受，客户端继续发送请求
- 101 ： 服务器将遵从客户端请求转换到另外一种协议
- 200 ：一切正常，对GET和POST请求的应答文档跟在后面
- 201 ：服务器已经创建了文档，Location头给出了它的URL
- 202 ： 已经接受请求，但是处理尚未完成
- 300 ：客户请求的文档可以在多个位置找到，这些位置已经返回的文档列出。如果服务器要提出优先选择，则应该在Location应答头指明
- 301 ：客户端请求的文档在其他地方，新的URL在location头中给出，浏览器自动访问新的URL
- 304 ：客户端有缓存的文档并发出了一个条件性的请求。服务器告诉客户，原来缓冲的文档还可以继续使用。资源未被修改过。
- 
- 400 ：请求出现语法错误
- 403 ：资源不可用
- 404 ： 无法找到指定位置的资源
- 500 ： 服务器遇到以外，不能完成客户请求
- 501 ：服务器不支持实现请求所需要的功能，例如客户端发出一个服务器不支持的put请求
- 505 ： 服务器不支持请求中的http版本